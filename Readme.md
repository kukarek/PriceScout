# üéØ –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞

–£—á–µ–±–Ω–∞—è **–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞-–∞–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤**, –∫–æ—Ç–æ—Ä–∞—è:

- –∏—â–µ—Ç —Ç–æ–≤–∞—Ä—ã –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –∞—Ä—Ç–∏–∫—É–ª—É –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö,
    
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **AI (GPT API)** –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–ª–æ—â–∞–¥–æ–∫ –ø–æ–¥ –∑–∞–ø—Ä–æ—Å,
    
- –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø–æ–¥–ø–∏—Å–∫–∏**,
    
- –≤–µ–¥—ë—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
    
- –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ **–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ**,
    
- –¥–µ–ø–ª–æ–∏—Ç—Å—è —á–µ—Ä–µ–∑ **Docker/Kubernetes**.
    

---

# üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è)

```
Client (CLI/Web/Postman)
        ‚îÇ
        ‚ñº
 [GraphQL Gateway] ‚îÄ‚îÄ‚îÄ‚ñ∫ [Auth & Billing] ‚îÄ‚ñ∫ PG (users, plans)
        ‚îÇ
        ‚îú‚îÄ‚îÄ‚ñ∫ [Search Orchestrator] ‚îÄ‚îÄ‚ñ∫ [AI Router (GPT API)]
        ‚îÇ                  ‚îÇ
        ‚îÇ                  ‚îú‚îÄ‚ñ∫ [Scraper: WB]
        ‚îÇ                  ‚îú‚îÄ‚ñ∫ [Scraper: Ozon]
        ‚îÇ                  ‚îî‚îÄ‚ñ∫ [Scraper: Avito] ...
        ‚îÇ
        ‚îî‚îÄ‚îÄ‚ñ∫ [Analytics Service] ‚óÑ‚îÄ(events)
        
Storage: PostgreSQL (offers, users, events)  
Cache:   Redis  
Queue:   RabbitMQ/Kafka  
```

---

# üî© –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

1. **GraphQL Gateway**
    
    - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã (`search`, `login`, `me`).
        
    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —É Auth-—Å–µ—Ä–≤–∏—Å–∞.
        
    - –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ Orchestrator.
        
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Analytics.
        
2. **Auth & Billing**
    
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, JWT.
        
    - –ü–æ–¥–ø–∏—Å–∫–∏ (free/pro).
        
    - –ö–≤–æ—Ç—ã –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–æ–≤.
        
    - –¢–∞–±–ª–∏—Ü—ã: `users`, `plans`, `subscriptions`.
        
3. **Search Orchestrator**
    
    - –ü–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç Gateway.
        
    - –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç **AI Router (GPT API)**: –∫–∞–∫–∏–µ –ø–ª–æ—â–∞–¥–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
        
    - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –¥–µ—Ä–≥–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ Scraper-—Å–µ—Ä–≤–∏—Å—ã.
        
    - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ—Ñ—Ñ–µ—Ä—ã, —É–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏, —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç.
        
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ PG.
        
4. **Scraper-—Å–µ—Ä–≤–∏—Å—ã** (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –ø–ª–æ—â–∞–¥–∫—É)
    
    - gRPC API: `Search(query, sku) -> [Offer]`.
        
    - –£ –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ—è –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞.
        
    - –í–æ–∑–≤—Ä–∞—â–∞—é—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
        
5. **Analytics Service**
    
    - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è (`search.requested`, `search.result_size`).
        
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PG (—Ç–∞–±–ª–∏—Ü–∞ `events`).
        
    - –°—á–∏—Ç–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).
        

---

# üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–ø–∏—Å–∫–∏

- **JWT** (access + refresh).
    
- –¢–∞—Ä–∏—Ñ—ã:
    
    - `free`: 10 –ø–æ–∏—Å–∫–æ–≤ –≤ –¥–µ–Ω—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–ª–æ—â–∞–¥–∫–∏.
        
    - `pro`: –±–µ–∑–ª–∏–º–∏—Ç.
        
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π ‚Äî —Å–Ω–∞—á–∞–ª–∞ mock, –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å.
    

---

# üóÉ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

**users**: `id`, `email`, `password_hash`, `plan`, `quota_left`  
**products**: `id`, `canonical_name`, `sku`, `category`  
**offers**: `id`, `product_id`, `marketplace`, `price`, `url`, `title`  
**events**: `id`, `user_id`, `event_type`, `payload(jsonb)`, `ts`

---

# ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Python 3.11**, FastAPI, Pydantic
    
- **GraphQL**: Strawberry
    
- **gRPC**: betterproto/grpclib
    
- **PostgreSQL** + SQLAlchemy
    
- **Redis** (–∫—ç—à, –ª–∏–º–∏—Ç—ã)
    
- **RabbitMQ/Kafka** (—Å–æ–±—ã—Ç–∏—è)
    
- **Celery** (—Ñ–æ–Ω–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
    
- **Docker + K8s** (–¥–µ–ø–ª–æ–π)
    


---

## üîó –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (–ø—Ä–∏–º–µ—Ä)

1. –ö–ª–∏–µ–Ω—Ç ‚Üí Gateway ‚Üí Search API (`"–Ω–∞–π—Ç–∏ iPhone 14"`)
    
2. Search API ‚Üí AI Routing (`–∫—É–¥–∞ –∏–¥—Ç–∏`)
    
3. AI Routing ‚Üí –≤—ã–±—Ä–∞–ª: Ozon, M.Video, –°–∏—Ç–∏–ª–∏–Ω–∫.
    
4. Gateway ‚Üí –∑–∞–ø—Ä–æ—Å –≤ Aggregator.
    
5. Aggregator ‚Üí –ø—É—à–∏—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka: `search.requested`.
    
6. –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–≤ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –≤ K8s (HPA –∞–≤—Ç–æ—Å–∫–µ–π–ª).
    
7. –ö–æ–Ω–Ω–µ–∫—Ç–æ—Ä—ã –Ω–∞—Ö–æ–¥—è—Ç —Ç–æ–≤–∞—Ä—ã ‚Üí –ø–∏—à—É—Ç –≤ Kafka: `product.found`.
    
8. Aggregator —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á–∏—Å—Ç–∏—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã.
    
9. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí Gateway ‚Üí –∫–ª–∏–µ–Ω—Ç.

___ 
