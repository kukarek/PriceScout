
---

# **1. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö**

Analytics Service –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π (RabbitMQ/Kafka)**:

|–ò—Å—Ç–æ—á–Ω–∏–∫|–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö|–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Analytics|
|---|---|---|
|GraphQL Gateway|–°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–æ–∏—Å–∫, –∫–ª–∏–∫, —Ñ–∏–ª—å—Ç—Ä—ã)|–æ—á–µ—Ä–µ–¥—å `analytics.events`|
|Aggregator|–õ–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, —Å—Ç–∞—Ç—É—Å—ã —Å–∫—Ä–∞–ø–ø–µ—Ä–æ–≤|–æ—á–µ—Ä–µ–¥—å `analytics.events`|
|Scraper (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)|–ú–µ—Ç—Ä–∏–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞|–æ—á–µ—Ä–µ–¥—å `analytics.events`|
|AI Router (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)|–ú–µ—Ç—Ä–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ AI (–≤—Ä–µ–º—è, –æ—à–∏–±–∫–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)|–æ—á–µ—Ä–µ–¥—å `analytics.events`|

**–í–∞–∂–Ω–æ:** —Å–µ—Ä–≤–∏—Å **–Ω–µ –¥–µ–ª–∞–µ—Ç –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º**, –æ–Ω —Ç–æ–ª—å–∫–æ **–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç/–∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –∏—Ö**.

---

# **2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Analytics Service**

```bash
analytics_service/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.py            # REST/GraphQL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (DB, –±—Ä–æ–∫–µ—Ä, –æ—á–µ—Ä–µ–¥–∏)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.py            # –õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π –∏ –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py             # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ consumers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events_consumer.py   # –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –æ—á–µ—Ä–µ–¥—å —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ aggregator.py        # –ê–≥—Ä–µ–≥–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.py           # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (PostgreSQL)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reporting.py         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ / –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ event.py             # Pydantic –º–æ–¥–µ–ª–∏ UserEvent, ScraperEvent
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ report.py            # –ú–æ–¥–µ–ª–∏ –æ—Ç—á—ë—Ç–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ main.py                  # –ó–∞–ø—É—Å–∫ FastAPI + consumer
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_aggregator.py
‚îÇ   ‚îú‚îÄ‚îÄ test_storage.py
‚îÇ   ‚îî‚îÄ‚îÄ test_integration.py
‚îÇ
‚îú‚îÄ‚îÄ dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```

---

# **3. –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ Analytics**

1. **Gateway / Aggregator / Scraper ‚Üí –æ—á–µ—Ä–µ–¥—å `analytics.events`**
    
    - –ü—Ä–∏–º–µ—Ä —Å–æ–±—ã—Ç–∏—è –æ—Ç Gateway:
        

```json
{
  "user_id": "uuid-1234",
  "action": "search",
  "query": "–∞–π—Ñ–æ–Ω",
  "timestamp": "2025-08-23T16:05:00Z"
}
```

2. **Consumer –≤ Analytics Service**
    
    - –°–ª—É—à–∞–µ—Ç –æ—á–µ—Ä–µ–¥—å
        
    - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ
        
    - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ PostgreSQL –∏–ª–∏ Redis
        
3. **Aggregator / Reporting**
    
    - –°—á–∏—Ç–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: —Ç–æ–ø–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—à–∏–±–∫–∏ —Å–∫—Ä–∞–ø–ø–µ—Ä–æ–≤
        
    - REST/GraphQL —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ –∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏
        

---

# **4. –ú–∏–Ω–∏-ER –º–æ–¥–µ–ª–∏**

- **UserEvent**
    

```python
class UserEvent(BaseModel):
    user_id: str
    action: str  # "search", "click", "filter"
    query: Optional[str]
    timestamp: datetime
```

- **ScraperEvent**
    

```python
class ScraperEvent(BaseModel):
    request_id: str
    scraper: str
    status: str  # "done", "error"
    duration_ms: int
    timestamp: datetime
```

- **Report**
    

```python
class Report(BaseModel):
    top_queries: list[str]
    most_active_users: list[str]
    scraper_stats: dict
```

---

### üîπ **–ò—Ç–æ–≥**

- Analytics Service **—á–∏—Ç–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–µ–π** –∏ **–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–∏—Å–∞–º**.
    
- –°–µ—Ä–≤–∏—Å **–∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç—á—ë—Ç—ã**.
    
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–∏—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.
    

---
